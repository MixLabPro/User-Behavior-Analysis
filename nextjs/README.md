# Sarahçš„AIåˆ›é€ ä¹‹æ—… - Next.jsæ¼”ç¤ºé¡¹ç›®

è¿™æ˜¯ä¸€ä¸ªåŸºäºŽNext.jsçš„ç”¨æˆ·è¡Œä¸ºåˆ†æžæ¼”ç¤ºé¡¹ç›®ï¼Œå±•ç¤ºäº†å¦‚ä½•é›†æˆ`user-behavior-analysis`åº“æ¥è¿½è¸ªç”¨æˆ·è¡Œä¸ºã€‚

## åŠŸèƒ½ç‰¹æ€§

- ðŸŽ¨ ç²¾ç¾Žçš„UIè®¾è®¡ï¼Œå±•ç¤ºSarahçš„AIç¼–ç¨‹ä¹‹æ—…
- ðŸ“Š å®Œæ•´çš„ç”¨æˆ·è¡Œä¸ºè¿½è¸ªç³»ç»Ÿ
- ðŸ–¼ï¸ AIå›¾ç‰‡ç”ŸæˆåŠŸèƒ½ï¼ˆéœ€è¦SiliconFlow APIå¯†é’¥ï¼‰
- ðŸ“‹ å¯Œæ–‡æœ¬å¤åˆ¶åŠŸèƒ½
- ðŸ”’ æœ¬åœ°APIå¯†é’¥å­˜å‚¨
- ðŸ’¾ åŸ‹ç‚¹æ•°æ®ç¼“å­˜å’ŒæŸ¥è¯¢ç³»ç»Ÿ

## ç”¨æˆ·è¡Œä¸ºè¿½è¸ªåŠŸèƒ½

é¡¹ç›®é›†æˆäº†`user-behavior-analysis`åº“ï¼Œè‡ªåŠ¨è¿½è¸ªä»¥ä¸‹ç”¨æˆ·è¡Œä¸ºï¼š

- **é¡µé¢æµè§ˆ**ï¼šè‡ªåŠ¨è®°å½•é¡µé¢è®¿é—®
- **ç‚¹å‡»äº‹ä»¶**ï¼šè¿½è¸ªæŒ‰é’®ç‚¹å‡»ã€é“¾æŽ¥ç‚¹å‡»ç­‰
- **æ»šåŠ¨è¡Œä¸º**ï¼šè®°å½•é¡µé¢æ»šåŠ¨æ·±åº¦
- **è¡¨å•äº¤äº’**ï¼šè¿½è¸ªè¡¨å•æäº¤å’Œè¾“å…¥
- **è‡ªå®šä¹‰äº‹ä»¶**ï¼šæ‰‹åŠ¨è¿½è¸ªç‰¹å®šä¸šåŠ¡äº‹ä»¶

### è¿½è¸ªçš„äº‹ä»¶ç±»åž‹

1. **é¡µé¢æµè§ˆ** (`page_view`)
2. **æŒ‰é’®ç‚¹å‡»** (`button_click`)
3. **APIå¯†é’¥ä¿å­˜** (`api_key_saved`)
4. **å†…å®¹å¤åˆ¶** (`content_copied`)
5. **å›¾ç‰‡ç”Ÿæˆ** (`image_generated`)
6. **å›¾ç‰‡ç”Ÿæˆå¤±è´¥** (`image_generation_failed`)

## å®‰è£…å’Œè¿è¡Œ

### 1. å®‰è£…ä¾èµ–

```bash
npm install
```

### 2. å¯åŠ¨å¼€å‘æœåŠ¡å™¨

```bash
npm run dev
```

### 3. è®¿é—®åº”ç”¨

- ä¸»é¡µé¢ï¼š[http://localhost:3000](http://localhost:3000)
- æµ‹è¯•é¡µé¢ï¼š[http://localhost:3000/test](http://localhost:3000/test)
- åŸ‹ç‚¹è®°å½•é¡µé¢ï¼š[http://localhost:3000/tracks](http://localhost:3000/tracks)

## é…ç½®è¯´æ˜Ž

### ç”¨æˆ·è¡Œä¸ºåˆ†æžé…ç½®

åœ¨`src/app/page.tsx`ä¸­ï¼Œä½ å¯ä»¥ä¿®æ”¹`userBehaviour`çš„é…ç½®ï¼š

```typescript
uba.config({
  sendUrl: 'http://localhost:3000/api/track', // åŽç«¯æŽ¥å£åœ°å€
  appId: 'sarah-ai-journey',                   // åº”ç”¨æ ‡è¯†
  userId: 'anonymous-user',                    // ç”¨æˆ·æ ‡è¯†
  debug: true,                                 // è°ƒè¯•æ¨¡å¼
  autoSendEvents: true,                        // è‡ªåŠ¨å‘é€äº‹ä»¶
  clicks: true,                                // è¿½è¸ªç‚¹å‡»
  mouseScroll: true,                           // è¿½è¸ªæ»šåŠ¨
  formInteractions: true,                      // è¿½è¸ªè¡¨å•
  processData: (results) => {
    // è‡ªå®šä¹‰æ•°æ®å¤„ç†é€»è¾‘
    console.log('ç”¨æˆ·è¡Œä¸ºæ•°æ®:', results);
  }
});
```

### APIæŽ¥å£

é¡¹ç›®åŒ…å«å®Œæ•´çš„APIæŽ¥å£æ¥å¤„ç†ç”¨æˆ·è¡Œä¸ºæ•°æ®ï¼š

#### 1. ç”¨æˆ·è¡Œä¸ºè¿½è¸ªæŽ¥å£

- **POST** `/api/track` - æŽ¥æ”¶ç”¨æˆ·è¡Œä¸ºæ•°æ®
- **GET** `/api/track` - æ£€æŸ¥APIçŠ¶æ€

**POST /api/track è¯·æ±‚ç¤ºä¾‹ï¼š**
```javascript
fetch('/api/track', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    event: 'page_view',
    page: '/home',
    userId: 'user123',
    timestamp: new Date().toISOString()
  })
});
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "success": true,
  "message": "æ•°æ®æŽ¥æ”¶æˆåŠŸ",
  "timestamp": "2024-01-01T12:00:00.000Z",
  "data": {
    "event": "page_view",
    "page": "/home",
    "userId": "user123"
  }
}
```

#### 2. åŸ‹ç‚¹è®°å½•æŸ¥è¯¢æŽ¥å£

- **GET** `/api/tracks` - èŽ·å–åŸ‹ç‚¹è®°å½•ï¼ˆæ”¯æŒåˆ†é¡µï¼‰
- **DELETE** `/api/tracks` - æ¸…é™¤ç¼“å­˜ï¼ˆä»…å¼€å‘çŽ¯å¢ƒï¼‰

**GET /api/tracks è¯·æ±‚å‚æ•°ï¼š**
- `page` (å¯é€‰): é¡µç ï¼Œé»˜è®¤ä¸º1
- `limit` (å¯é€‰): æ¯é¡µè®°å½•æ•°ï¼Œé»˜è®¤ä¸º100ï¼Œæœ€å¤§1000

**è¯·æ±‚ç¤ºä¾‹ï¼š**
```javascript
// èŽ·å–ç¬¬1é¡µï¼Œæ¯é¡µ10æ¡è®°å½•
fetch('/api/tracks?page=1&limit=10')

// èŽ·å–æœ€è¿‘100æ¡è®°å½•
fetch('/api/tracks')
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "success": true,
  "data": {
    "records": [
      {
        "id": "abc123",
        "timestamp": "2024-01-01T12:00:00.000Z",
        "data": {
          "event": "page_view",
          "page": "/home",
          "userId": "user123"
        },
        "userAgent": "Mozilla/5.0...",
        "ip": "127.0.0.1"
      }
    ],
    "pagination": {
      "currentPage": 1,
      "totalPages": 5,
      "totalRecords": 50,
      "limit": 10,
      "hasNextPage": true,
      "hasPrevPage": false
    }
  },
  "timestamp": "2024-01-01T12:00:00.000Z"
}
```

### ç¼“å­˜ç³»ç»Ÿ

é¡¹ç›®ä½¿ç”¨å†…å­˜ç¼“å­˜ç³»ç»Ÿæ¥å­˜å‚¨åŸ‹ç‚¹è®°å½•ï¼š

- **æœ€å¤§è®°å½•æ•°**: 1000æ¡
- **è‡ªåŠ¨æ¸…ç†**: è¶…è¿‡æœ€å¤§è®°å½•æ•°æ—¶è‡ªåŠ¨åˆ é™¤æœ€æ—§çš„è®°å½•
- **æ•°æ®æŒä¹…æ€§**: å†…å­˜ç¼“å­˜ï¼ŒæœåŠ¡å™¨é‡å¯åŽæ•°æ®ä¼šä¸¢å¤±
- **è®°å½•ä¿¡æ¯**: åŒ…å«IDã€æ—¶é—´æˆ³ã€æ•°æ®å†…å®¹ã€User Agentã€IPåœ°å€

## é¡¹ç›®ç»“æž„

```
src/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”œâ”€â”€ track/
â”‚   â”‚   â”‚   â””â”€â”€ route.ts          # ç”¨æˆ·è¡Œä¸ºè¿½è¸ªAPI
â”‚   â”‚   â””â”€â”€ tracks/
â”‚   â”‚       â””â”€â”€ route.ts          # åŸ‹ç‚¹è®°å½•æŸ¥è¯¢API
â”‚   â”œâ”€â”€ tracks/
â”‚   â”‚   â””â”€â”€ page.tsx              # åŸ‹ç‚¹è®°å½•å±•ç¤ºé¡µé¢
â”‚   â”œâ”€â”€ test/
â”‚   â”‚   â””â”€â”€ page.tsx              # æµ‹è¯•é¡µé¢
â”‚   â”œâ”€â”€ globals.css               # å…¨å±€æ ·å¼
â”‚   â”œâ”€â”€ layout.tsx                # å¸ƒå±€ç»„ä»¶
â”‚   â””â”€â”€ page.tsx                  # ä¸»é¡µé¢
â”œâ”€â”€ lib/
â”‚   â””â”€â”€ cache.ts                  # ç¼“å­˜ç³»ç»Ÿ
â”œâ”€â”€ public/
â”‚   â””â”€â”€ user-behaviour.js         # ç”¨æˆ·è¡Œä¸ºè¿½è¸ªåº“
â””â”€â”€ ...
```

## æµ‹è¯•ç”¨æˆ·è¡Œä¸ºè¿½è¸ª

### ä½¿ç”¨æµ‹è¯•è„šæœ¬

é¡¹ç›®åŒ…å«ä¸€ä¸ªæµ‹è¯•è„šæœ¬æ¥éªŒè¯APIåŠŸèƒ½ï¼š

```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•è¿è¡Œ
node test-api.js
```

### æ‰‹åŠ¨æµ‹è¯•

1. è®¿é—®ä¸»é¡µé¢ï¼Œè§¦å‘ä¸€äº›ç”¨æˆ·è¡Œä¸º
2. è®¿é—® `/tracks` é¡µé¢æŸ¥çœ‹åŸ‹ç‚¹è®°å½•
3. ä½¿ç”¨APIæŽ¥å£ç›´æŽ¥æŸ¥è¯¢æ•°æ®

### æµ‹è¯•åŸ‹ç‚¹æ•°æ®å‘é€

```javascript
// åœ¨æµè§ˆå™¨æŽ§åˆ¶å°ä¸­è¿è¡Œ
fetch('/api/track', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    event: 'test_event',
    message: 'æµ‹è¯•æ•°æ®',
    timestamp: new Date().toISOString()
  })
});
```

### æµ‹è¯•åŸ‹ç‚¹è®°å½•æŸ¥è¯¢

```javascript
// èŽ·å–æœ€è¿‘10æ¡è®°å½•
fetch('/api/tracks?limit=10')
  .then(response => response.json())
  .then(data => console.log(data));
```
