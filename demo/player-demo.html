<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç”¨æˆ·è¡Œä¸ºæ’­æ”¾å™¨æ¼”ç¤º</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        
        .demo-section {
            margin: 30px 0;
            padding: 20px;
            border: 2px dashed #ddd;
            border-radius: 8px;
        }
        
        .controls {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        button {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        
        .primary-btn {
            background: #007bff;
            color: white;
        }
        
        .primary-btn:hover {
            background: #0056b3;
        }
        
        .secondary-btn {
            background: #6c757d;
            color: white;
        }
        
        .secondary-btn:hover {
            background: #545b62;
        }
        
        .success-btn {
            background: #28a745;
            color: white;
        }
        
        .success-btn:hover {
            background: #1e7e34;
        }
        
        .danger-btn {
            background: #dc3545;
            color: white;
        }
        
        .danger-btn:hover {
            background: #c82333;
        }
        
        .info-box {
            background: #e7f3ff;
            border: 1px solid #b3d9ff;
            border-radius: 5px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .sample-form {
            display: grid;
            gap: 15px;
            max-width: 400px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
        }
        
        label {
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        input, textarea, select {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .interactive-area {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        
        .status {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 10px 15px;
            border-radius: 5px;
            font-size: 12px;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <div class="status" id="status">å‡†å¤‡å°±ç»ª</div>
    
    <div class="container">
        <h1>ğŸ¬ ç”¨æˆ·è¡Œä¸ºæ’­æ”¾å™¨æ¼”ç¤º</h1>
        
        <div class="info-box">
            <strong>ä½¿ç”¨è¯´æ˜ï¼š</strong>
            <ol>
                <li>ç‚¹å‡»"å¼€å§‹å½•åˆ¶"æŒ‰é’®å¼€å§‹æ”¶é›†ç”¨æˆ·è¡Œä¸ºæ•°æ®</li>
                <li>åœ¨é¡µé¢ä¸Šè¿›è¡Œå„ç§æ“ä½œï¼ˆç§»åŠ¨é¼ æ ‡ã€ç‚¹å‡»ã€æ»šåŠ¨ã€è¾“å…¥ç­‰ï¼‰</li>
                <li>ç‚¹å‡»"åœæ­¢å½•åˆ¶"æŒ‰é’®ç»“æŸæ•°æ®æ”¶é›†</li>
                <li>ç‚¹å‡»"æ’­æ”¾å½•åˆ¶"æŒ‰é’®è§‚çœ‹è¡Œä¸ºå›æ”¾åŠ¨ç”»</li>
            </ol>
        </div>
        
        <div class="controls">
            <button id="startRecord" class="primary-btn">ğŸ”´ å¼€å§‹å½•åˆ¶</button>
            <button id="stopRecord" class="secondary-btn" disabled>â¹ï¸ åœæ­¢å½•åˆ¶</button>
            <button id="playRecord" class="success-btn" disabled>â–¶ï¸ æ’­æ”¾å½•åˆ¶</button>
            <button id="clearData" class="danger-btn">ğŸ—‘ï¸ æ¸…é™¤æ•°æ®</button>
        </div>
        
        <div class="demo-section">
            <h3>ğŸ“ äº¤äº’æµ‹è¯•åŒºåŸŸ</h3>
            <p>åœ¨è¿™ä¸ªåŒºåŸŸè¿›è¡Œå„ç§æ“ä½œæ¥ç”Ÿæˆæµ‹è¯•æ•°æ®ï¼š</p>
            
            <div class="interactive-area">
                <h4>è¡¨å•æµ‹è¯•</h4>
                <form class="sample-form" id="testForm">
                    <div class="form-group">
                        <label for="username">ç”¨æˆ·åï¼š</label>
                        <input type="text" id="username" name="username" placeholder="è¯·è¾“å…¥ç”¨æˆ·å">
                    </div>
                    
                    <div class="form-group">
                        <label for="email">é‚®ç®±ï¼š</label>
                        <input type="email" id="email" name="email" placeholder="è¯·è¾“å…¥é‚®ç®±">
                    </div>
                    
                    <div class="form-group">
                        <label for="category">åˆ†ç±»ï¼š</label>
                        <select id="category" name="category">
                            <option value="">è¯·é€‰æ‹©</option>
                            <option value="tech">æŠ€æœ¯</option>
                            <option value="design">è®¾è®¡</option>
                            <option value="marketing">è¥é”€</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="message">ç•™è¨€ï¼š</label>
                        <textarea id="message" name="message" rows="4" placeholder="è¯·è¾“å…¥æ‚¨çš„ç•™è¨€"></textarea>
                    </div>
                    
                    <button type="submit" class="primary-btn">æäº¤è¡¨å•</button>
                </form>
            </div>
            
            <div class="interactive-area">
                <h4>æŒ‰é’®æµ‹è¯•</h4>
                <div class="controls">
                    <button class="primary-btn" onclick="showAlert('ä¸»è¦æŒ‰é’®')">ä¸»è¦æŒ‰é’®</button>
                    <button class="secondary-btn" onclick="showAlert('æ¬¡è¦æŒ‰é’®')">æ¬¡è¦æŒ‰é’®</button>
                    <button class="success-btn" onclick="showAlert('æˆåŠŸæŒ‰é’®')">æˆåŠŸæŒ‰é’®</button>
                    <button class="danger-btn" onclick="showAlert('å±é™©æŒ‰é’®')">å±é™©æŒ‰é’®</button>
                </div>
            </div>
            
            <div class="interactive-area">
                <h4>æ»šåŠ¨æµ‹è¯•</h4>
                <p>å‘ä¸‹æ»šåŠ¨é¡µé¢æ¥æµ‹è¯•æ»šåŠ¨äº‹ä»¶çš„è®°å½•å’Œå›æ”¾ã€‚</p>
                <div style="height: 200px; overflow-y: scroll; border: 1px solid #ddd; padding: 10px;">
                    <p>è¿™æ˜¯ä¸€ä¸ªå¯æ»šåŠ¨çš„åŒºåŸŸã€‚</p>
                    <p>ä½ å¯ä»¥åœ¨è¿™é‡Œæ»šåŠ¨é¼ æ ‡æ»šè½®ã€‚</p>
                    <p>æ»šåŠ¨è¡Œä¸ºä¼šè¢«è®°å½•ä¸‹æ¥ã€‚</p>
                    <p>åœ¨æ’­æ”¾æ—¶ä¼šé‡ç°æ»šåŠ¨åŠ¨ä½œã€‚</p>
                    <p>ç»§ç»­æ»šåŠ¨...</p>
                    <p>æ›´å¤šå†…å®¹...</p>
                    <p>æ›´å¤šå†…å®¹...</p>
                    <p>æ›´å¤šå†…å®¹...</p>
                    <p>æ›´å¤šå†…å®¹...</p>
                    <p>æ›´å¤šå†…å®¹...</p>
                    <p>æ»šåŠ¨åˆ°åº•éƒ¨äº†ï¼</p>
                </div>
            </div>
        </div>
        
        <div class="demo-section">
            <h3>ğŸ“Š å½•åˆ¶æ•°æ®é¢„è§ˆ</h3>
            <div id="dataPreview" class="info-box">
                <p>æš‚æ— å½•åˆ¶æ•°æ®</p>
            </div>
        </div>
    </div>

    <!-- å¼•å…¥ç”¨æˆ·è¡Œä¸ºè¿½è¸ªåº“ -->
    <script src="../dist/userBehaviour.js"></script>
    <!-- å¼•å…¥æ’­æ”¾å™¨åº“ -->
    <script src="../dist/userBehaviourPlayer.js"></script>
    
    <script>
        // å…¨å±€å˜é‡
        let isRecording = false;
        let recordedData = null;
        let currentPlayer = null;
        
        // DOM å…ƒç´ å¼•ç”¨
        const startBtn = document.getElementById('startRecord');
        const stopBtn = document.getElementById('stopRecord');
        const playBtn = document.getElementById('playRecord');
        const clearBtn = document.getElementById('clearData');
        const status = document.getElementById('status');
        const dataPreview = document.getElementById('dataPreview');
        
        // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
        function updateStatus(message) {
            status.textContent = message;
        }
        
        // æ›´æ–°æŒ‰é’®çŠ¶æ€
        function updateButtons() {
            startBtn.disabled = isRecording;
            stopBtn.disabled = !isRecording;
            playBtn.disabled = !recordedData || isRecording;
        }
        
        // æ˜¾ç¤ºæç¤ºæ¡†
        function showAlert(message) {
            alert(`ä½ ç‚¹å‡»äº†ï¼š${message}`);
        }
        
        // æ ¼å¼åŒ–æ•°æ®é¢„è§ˆ
        function formatDataPreview(data) {
            if (!data) {
                return '<p>æš‚æ— å½•åˆ¶æ•°æ®</p>';
            }
            
            const stats = {
                é¼ æ ‡ç§»åŠ¨: data.mouseMovements?.length || 0,
                ç‚¹å‡»æ¬¡æ•°: data.clicks?.clickCount || 0,
                æ»šåŠ¨æ¬¡æ•°: data.mouseScroll?.length || 0,
                é”®ç›˜æ´»åŠ¨: data.keyboardActivities?.length || 0,
                çª—å£å˜åŒ–: data.windowSizes?.length || 0,
                å½•åˆ¶æ—¶é•¿: data.time?.startTime && data.time?.stopTime ? 
                    `${Math.round((new Date(data.time.stopTime).getTime() - new Date(data.time.startTime).getTime()) / 1000)}ç§’` : 'æœªçŸ¥'
            };
            
            let html = '<h4>ğŸ“ˆ å½•åˆ¶ç»Ÿè®¡</h4><ul>';
            for (const [key, value] of Object.entries(stats)) {
                html += `<li><strong>${key}:</strong> ${value}</li>`;
            }
            html += '</ul>';
            
            return html;
        }
        
        // å¼€å§‹å½•åˆ¶
        function startRecording() {
            try {
                // é…ç½®ç”¨æˆ·è¡Œä¸ºè¿½è¸ª
                window.userBehaviour.config({
                    userInfo: true,
                    clicks: true,
                    mouseMovement: true,
                    mouseMovementInterval: 0.1, // æ›´é¢‘ç¹çš„è®°å½•
                    mouseScroll: true,
                    timeCount: true,
                    clearAfterProcess: false,
                    processTime: 0, // ä¸è‡ªåŠ¨å¤„ç†
                    windowResize: true,
                    visibilitychange: true,
                    keyboardActivity: true,
                    pageNavigation: true,
                    formInteractions: true,
                    touchEvents: true,
                    audioVideoInteraction: true,
                    autoSendEvents: false
                });
                
                // å¼€å§‹è¿½è¸ª
                window.userBehaviour.start();
                
                isRecording = true;
                updateStatus('ğŸ”´ æ­£åœ¨å½•åˆ¶...');
                updateButtons();
                
                console.log('å¼€å§‹å½•åˆ¶ç”¨æˆ·è¡Œä¸º');
            } catch (error) {
                console.error('å¯åŠ¨å½•åˆ¶å¤±è´¥:', error);
                updateStatus('âŒ å½•åˆ¶å¯åŠ¨å¤±è´¥');
            }
        }
        
        // åœæ­¢å½•åˆ¶
        function stopRecording() {
            try {
                // åœæ­¢è¿½è¸ªå¹¶è·å–æ•°æ®
                window.userBehaviour.stop();
                recordedData = window.userBehaviour.showResult();
                
                isRecording = false;
                updateStatus('â¹ï¸ å½•åˆ¶å·²åœæ­¢');
                updateButtons();
                
                // æ›´æ–°æ•°æ®é¢„è§ˆ
                dataPreview.innerHTML = formatDataPreview(recordedData);
                
                console.log('å½•åˆ¶æ•°æ®:', recordedData);
            } catch (error) {
                console.error('åœæ­¢å½•åˆ¶å¤±è´¥:', error);
                updateStatus('âŒ åœæ­¢å½•åˆ¶å¤±è´¥');
            }
        }
        
        // æ’­æ”¾å½•åˆ¶
        function playRecording() {
            if (!recordedData) {
                alert('æ²¡æœ‰å¯æ’­æ”¾çš„å½•åˆ¶æ•°æ®');
                return;
            }
            
            try {
                // é”€æ¯ä¹‹å‰çš„æ’­æ”¾å™¨
                if (currentPlayer) {
                    currentPlayer.destroy();
                }
                
                // åˆ›å»ºæ–°çš„æ’­æ”¾å™¨
                currentPlayer = window.userBehaviourPlayer;
                
                // é…ç½®æ’­æ”¾å™¨
                currentPlayer.configure({
                    playbackSpeed: 1.0,
                    showMouseTrail: true,
                    mouseTrailColor: '#ff4444',
                    mouseTrailWidth: 3,
                    showClickEffect: true,
                    clickEffectColor: '#44ff44',
                    clickEffectSize: 25,
                    showScrollIndicator: true,
                    showKeyboardInput: true,
                    controlPanelPosition: 'bottom',
                    autoPlay: true,
                    loop: false
                });
                
                // åŠ è½½å¹¶æ’­æ”¾æ•°æ®
                currentPlayer.load(recordedData);
                
                updateStatus('â–¶ï¸ æ­£åœ¨æ’­æ”¾å½•åˆ¶');
                
                console.log('å¼€å§‹æ’­æ”¾å½•åˆ¶æ•°æ®');
            } catch (error) {
                console.error('æ’­æ”¾å¤±è´¥:', error);
                updateStatus('âŒ æ’­æ”¾å¤±è´¥');
                alert('æ’­æ”¾å¤±è´¥: ' + error.message);
            }
        }
        
        // æ¸…é™¤æ•°æ®
        function clearData() {
            if (confirm('ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰å½•åˆ¶æ•°æ®å—ï¼Ÿ')) {
                recordedData = null;
                dataPreview.innerHTML = '<p>æš‚æ— å½•åˆ¶æ•°æ®</p>';
                updateStatus('ğŸ—‘ï¸ æ•°æ®å·²æ¸…é™¤');
                updateButtons();
                
                // é”€æ¯æ’­æ”¾å™¨
                if (currentPlayer) {
                    currentPlayer.destroy();
                    currentPlayer = null;
                }
            }
        }
        
        // ç»‘å®šäº‹ä»¶ç›‘å¬å™¨
        startBtn.addEventListener('click', startRecording);
        stopBtn.addEventListener('click', stopRecording);
        playBtn.addEventListener('click', playRecording);
        clearBtn.addEventListener('click', clearData);
        
        // è¡¨å•æäº¤å¤„ç†
        document.getElementById('testForm').addEventListener('submit', function(e) {
            e.preventDefault();
            alert('è¡¨å•æäº¤è¢«æ‹¦æˆªï¼ˆç”¨äºæ¼”ç¤ºï¼‰');
        });
        
        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            updateStatus('å‡†å¤‡å°±ç»ª');
            updateButtons();
            
            // æ£€æŸ¥åº“æ˜¯å¦åŠ è½½æˆåŠŸ
            if (typeof window.userBehaviour === 'undefined') {
                updateStatus('âŒ userBehaviour åº“æœªåŠ è½½');
                console.error('userBehaviour åº“æœªæ‰¾åˆ°');
            }
            
            if (typeof window.userBehaviourPlayer === 'undefined') {
                updateStatus('âŒ userBehaviourPlayer åº“æœªåŠ è½½');
                console.error('userBehaviourPlayer åº“æœªæ‰¾åˆ°');
            }
        });
        
        // çª—å£å…³é—­å‰æ¸…ç†
        window.addEventListener('beforeunload', function() {
            if (currentPlayer) {
                currentPlayer.destroy();
            }
        });
    </script>
</body>
</html>