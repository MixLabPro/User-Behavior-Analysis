<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web User Behaviour - TypeScript ç‰ˆæœ¬æ¼”ç¤º</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            line-height: 1.6;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .main-layout {
            display: flex;
            min-height: 100vh;
        }
        
        .sidebar {
            width: 350px;
            background: white;
            padding: 20px;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
            position: fixed;
            left: 0;
            top: 0;
            height: 100vh;
            overflow-y: auto;
            z-index: 1000;
        }
        
        .sidebar h2 {
            margin-top: 0;
            margin-bottom: 20px;
            text-align: center;
            color: #333;
            font-size: 18px;
        }
        
        .main-content {
            flex: 1;
            margin-left: 350px;
            padding: 20px;
        }
        
        .container {
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        
        .demo-section {
            margin: 30px 0;
            padding: 20px;
            border: 2px dashed #ddd;
            border-radius: 8px;
            background: #f9f9f9;
        }
        
        .demo-section h3 {
            color: #555;
            margin-top: 0;
        }
        
        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
            transition: background 0.3s;
        }
        
        button:hover {
            background: #5a6fd8;
        }
        
        input,
        textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin: 5px 0;
            font-size: 14px;
        }
        
        .stats {
            background: #e8f4f8;
            padding: 15px;
            border-radius: 6px;
            margin: 20px 0;
            font-family: monospace;
            font-size: 13px;
        }
        
        .log {
            background: #2d3748;
            color: #68d391;
            padding: 15px;
            border-radius: 6px;
            margin: 20px 0;
            font-family: monospace;
            font-size: 11px;
            height: calc(100vh - 400px);
            overflow-y: auto;
            border: 1px solid #4a5568;
        }
        
        .controls {
            text-align: center;
            margin: 20px 0;
        }
        
        .controls button {
            display: block;
            width: 100%;
            margin: 5px 0;
            font-size: 14px;
            padding: 8px 12px;
        }
        
        .video-container {
            text-align: center;
            margin: 20px 0;
        }
        
        video {
            max-width: 100%;
            border-radius: 8px;
        }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>

<body>
    <div class="main-layout">
        <!-- å·¦ä¾§å›ºå®šè¾¹æ  -->
        <div class="sidebar">
            <h2>ğŸ¯ ç”¨æˆ·è¡Œä¸ºè¿½è¸ª</h2>

            <div class="controls">
                <button onclick="startTracking()">ğŸš€ å¼€å§‹è¿½è¸ª</button>
                <button onclick="stopTracking()">â¹ï¸ åœæ­¢è¿½è¸ª</button>
                <button onclick="showResults()">ğŸ“Š æ˜¾ç¤ºç»“æœ</button>
                <button onclick="clearLog()">ğŸ—‘ï¸ æ¸…é™¤æ—¥å¿—</button>
                <button onclick="toggleDetailedLogs()" id="toggleLogsBtn">ğŸ” æ˜¾ç¤ºè¯¦ç»†æ—¥å¿—</button>
            </div>

            <div class="stats" id="stats">
                <strong>ğŸ“ˆ å®æ—¶ç»Ÿè®¡:</strong><br> è¿½è¸ªçŠ¶æ€: <span id="status">æœªå¼€å§‹</span><br> ç‚¹å‡»æ¬¡æ•°: <span id="clickCount">0</span><br> é¼ æ ‡ç§»åŠ¨: <span id="mouseCount">0</span><br> æ»šåŠ¨æ¬¡æ•°: <span id="scrollCount">0</span><br> é”®ç›˜æ´»åŠ¨: <span id="keyCount">0</span>
            </div>

            <div class="log" id="log">
                <div>ğŸ’¡ æç¤º: ç‚¹å‡»"å¼€å§‹è¿½è¸ª"æŒ‰é’®å¼€å§‹ç”¨æˆ·è¡Œä¸ºè¿½è¸ª...</div>
            </div>
        </div>

        <!-- å³ä¾§ä¸»è¦å†…å®¹åŒºåŸŸ -->
        <div class="main-content">
            <div class="container">
                <h1>ğŸ¯ Web User Behaviour - TypeScript ç‰ˆæœ¬æ¼”ç¤º</h1>

                <div class="grid">
                    <div class="demo-section">
                        <h3>ğŸ–±ï¸ é¼ æ ‡äº¤äº’æµ‹è¯•</h3>
                        <button onclick="handleClick('æŒ‰é’®1')">ç‚¹å‡»æˆ‘ - æŒ‰é’®1</button>
                        <button onclick="handleClick('æŒ‰é’®2')">ç‚¹å‡»æˆ‘ - æŒ‰é’®2</button>
                        <button onclick="handleClick('æŒ‰é’®3')">ç‚¹å‡»æˆ‘ - æŒ‰é’®3</button>
                        <p>ç§»åŠ¨é¼ æ ‡åˆ°è¿™ä¸ªåŒºåŸŸï¼Œæˆ–è€…ç‚¹å‡»ä¸Šé¢çš„æŒ‰é’®æ¥æµ‹è¯•é¼ æ ‡è¿½è¸ªåŠŸèƒ½ã€‚</p>
                    </div>

                    <div class="demo-section">
                        <h3>âŒ¨ï¸ é”®ç›˜äº¤äº’æµ‹è¯•</h3>
                        <input type="text" id="keyboard-test-input" placeholder="åœ¨è¿™é‡Œè¾“å…¥ä¸€äº›æ–‡å­—æ¥æµ‹è¯•é”®ç›˜è¿½è¸ª..." />
                        <textarea id="keyboard-test-textarea" placeholder="æˆ–è€…åœ¨è¿™ä¸ªæ–‡æœ¬åŒºåŸŸè¾“å…¥å¤šè¡Œæ–‡å­—..."></textarea>
                        <p>åœ¨è¾“å…¥æ¡†ä¸­è¾“å…¥æ–‡å­—æ¥æµ‹è¯•é”®ç›˜è¿½è¸ªåŠŸèƒ½ã€‚</p>
                    </div>
                </div>

                <div class="grid">
                    <div class="demo-section">
                        <h3>ğŸ“ è¡¨å•äº¤äº’æµ‹è¯•</h3>
                        <form onsubmit="handleFormSubmit(event)">
                            <input type="text" name="username" placeholder="ç”¨æˆ·å" required />
                            <input type="email" name="email" placeholder="é‚®ç®±" required />
                            <button type="submit">æäº¤è¡¨å•</button>
                        </form>
                    </div>

                    <div class="demo-section">
                        <h3>ğŸ“± è§¦æ‘¸äº‹ä»¶æµ‹è¯•</h3>
                        <div id="touch-test-area" style="background: #f0f0f0; padding: 20px; border-radius: 8px; text-align: center; min-height: 120px; display: flex; flex-direction: column; justify-content: center; align-items: center; cursor: pointer;">
                            <p>ç‚¹å‡»æˆ–è§¦æ‘¸è¿™ä¸ªåŒºåŸŸæ¥æµ‹è¯•è§¦æ‘¸äº‹ä»¶è¿½è¸ª</p>
                            <button id="touch-test-button" style="margin: 10px 0;">è§¦æ‘¸æµ‹è¯•æŒ‰é’®</button>
                            <div id="touch-status" style="font-size: 12px; color: #666; margin-top: 10px;">ç­‰å¾…è§¦æ‘¸äº‹ä»¶...</div>
                        </div>
                    </div>
                </div>

                <div class="demo-section">
                    <h3>ğŸµ åª’ä½“äº¤äº’æµ‹è¯•</h3>
                    <div class="video-container">
                        <video id="demo-video" controls width="100%" style="max-width: 400px;">
                    <source src="demo/test.mp4" type="video/mp4">
                    æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè§†é¢‘æ’­æ”¾ã€‚
                </video>
                        <p>æ’­æ”¾ä¸Šé¢çš„è§†é¢‘æ¥æµ‹è¯•åª’ä½“äº¤äº’è¿½è¸ªåŠŸèƒ½ã€‚</p>
                        <div style="margin-top: 10px;">
                            <button onclick="testVideoEvents()">æµ‹è¯•è§†é¢‘äº‹ä»¶</button>
                            <button onclick="logVideoInfo()">æ˜¾ç¤ºè§†é¢‘ä¿¡æ¯</button>
                        </div>
                    </div>
                </div>

                <div class="demo-section">
                    <h3>ğŸ”„ é¡µé¢å¯¼èˆªæµ‹è¯•</h3>
                    <button onclick="simulateNavigation()">æ¨¡æ‹Ÿé¡µé¢å¯¼èˆª</button>
                    <button onclick="changeHash()">æ”¹å˜ URL Hash</button>
                    <p>ç‚¹å‡»æŒ‰é’®æ¥æµ‹è¯•é¡µé¢å¯¼èˆªè¿½è¸ªåŠŸèƒ½ã€‚</p>
                </div>

                <div class="demo-section">
                    <h3>ğŸ“ çª—å£è°ƒæ•´æµ‹è¯•</h3>
                    <p>å°è¯•è°ƒæ•´æµè§ˆå™¨çª—å£å¤§å°æ¥æµ‹è¯•çª—å£å°ºå¯¸å˜åŒ–è¿½è¸ªã€‚</p>
                    <p>æˆ–è€…æŒ‰ F11 è¿›å…¥/é€€å‡ºå…¨å±æ¨¡å¼ã€‚</p>
                </div>

                <div class="demo-section">
                    <h3>ğŸ‘ï¸ é¡µé¢å¯è§æ€§æµ‹è¯•</h3>
                    <p>åˆ‡æ¢åˆ°å…¶ä»–æ ‡ç­¾é¡µæˆ–æœ€å°åŒ–æµè§ˆå™¨çª—å£æ¥æµ‹è¯•é¡µé¢å¯è§æ€§å˜åŒ–è¿½è¸ªã€‚</p>
                    <button onclick="simulateVisibilityChange()">æ¨¡æ‹Ÿå¯è§æ€§å˜åŒ–</button>
                </div>

                <div class="demo-section">
                    <h3>ğŸ¯ è‡ªå®šä¹‰äº‹ä»¶æµ‹è¯•</h3>
                    <p>æµ‹è¯•è‡ªå®šä¹‰äº‹ä»¶è¿½è¸ªåŠŸèƒ½</p>
                    <button onclick="testCustomEvent()">è§¦å‘è‡ªå®šä¹‰äº‹ä»¶</button>
                    <button onclick="registerCustomEvent()">æ³¨å†Œè‡ªå®šä¹‰äº‹ä»¶ç›‘å¬å™¨</button>
                </div>

                <div class="demo-section">
                    <h3>ğŸš€ NextJS åç«¯é›†æˆæµ‹è¯•</h3>
                    <p>æµ‹è¯•ä¸ NextJS åç«¯çš„é›†æˆåŠŸèƒ½</p>
                    <button onclick="testNextJSIntegration()">å¯åŠ¨ NextJS é›†æˆ</button>
                    <button onclick="stopNextJSIntegration()">åœæ­¢ NextJS é›†æˆ</button>
                    <div id="nextjs-status" style="margin-top: 10px; padding: 10px; background: #f0f0f0; border-radius: 4px; display: none;">
                        <strong>NextJS é›†æˆçŠ¶æ€:</strong> <span id="nextjs-status-text">æœªå¯åŠ¨</span>
                    </div>
                </div>

                <div style="height: 200px; background: linear-gradient(45deg, #f0f0f0, #e0e0e0); margin: 20px 0; border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                    <p>æ»šåŠ¨é¡µé¢æ¥æµ‹è¯•æ»šåŠ¨äº‹ä»¶è¿½è¸ª ğŸ“œ</p>
                </div>
            </div>
        </div>

        <!-- åŠ è½½ç¼–è¯‘åçš„ JavaScript æ–‡ä»¶ -->
        <script src="../dist/userBehaviour.js"></script>

        <script>
            // å…¨å±€å˜é‡
            let isTracking = false;
            let currentResults = null;
            let showDetailedLogs = false; // é»˜è®¤ä¸æ˜¾ç¤ºè¯¦ç»†JSONæ•°æ®

            // é…ç½®ç”¨æˆ·è¡Œä¸ºè¿½è¸ª
            const config = {
                // å¯ç”¨æ‰€æœ‰è¿½è¸ªåŠŸèƒ½
                userInfo: true,
                clicks: true,
                mouseMovement: true,
                mouseMovementInterval: 0.5,
                mouseScroll: true,
                timeCount: true,
                clearAfterProcess: false,
                processTime: 3, // æ¯3ç§’å¤„ç†ä¸€æ¬¡æ•°æ®
                windowResize: true,
                visibilitychange: true,
                keyboardActivity: true,
                pageNavigation: true,
                formInteractions: true,
                touchEvents: true,
                audioVideoInteraction: true,
                customEventRegistration: true,
                autoSendEvents: true,
                sendUrl: 'http://127.0.0.1:5005/get',

                // è‡ªå®šä¹‰æ•°æ®å¤„ç†å‡½æ•°
                processData: function(results) {
                    currentResults = results;
                    updateStats(results);
                    logActivity('ğŸ“Š æ•°æ®å¤„ç†å®Œæˆ', results);
                }
            };

            // åº”ç”¨é…ç½®
            userBehaviour.config(config);

            // æ³¨å†Œè‡ªå®šä¹‰äº‹ä»¶ç›‘å¬å™¨
            userBehaviour.registerCustomEvent('productView', function(event) {
                logActivity('ğŸ›ï¸ äº§å“æµè§ˆäº‹ä»¶', event.detail);
            });

            userBehaviour.registerCustomEvent('addToCart', function(event) {
                logActivity('ğŸ›’ æ·»åŠ è´­ç‰©è½¦äº‹ä»¶', event.detail);
            });

            userBehaviour.registerCustomEvent('purchase', function(event) {
                logActivity('ğŸ’³ è´­ä¹°äº‹ä»¶', event.detail);
            });

            // å¼€å§‹è¿½è¸ª
            function startTracking() {
                if (!isTracking) {
                    userBehaviour.start();
                    isTracking = true;
                    document.getElementById('status').textContent = 'è¿½è¸ªä¸­...';
                    logActivity('ğŸš€ å¼€å§‹ç”¨æˆ·è¡Œä¸ºè¿½è¸ª');
                } else {
                    logActivity('âš ï¸ è¿½è¸ªå·²ç»åœ¨è¿è¡Œä¸­');
                }
            }

            // åœæ­¢è¿½è¸ª
            function stopTracking() {
                if (isTracking) {
                    userBehaviour.stop();
                    isTracking = false;
                    document.getElementById('status').textContent = 'å·²åœæ­¢';
                    logActivity('â¹ï¸ åœæ­¢ç”¨æˆ·è¡Œä¸ºè¿½è¸ª');
                } else {
                    logActivity('âš ï¸ è¿½è¸ªå°šæœªå¼€å§‹');
                }
            }

            // æ˜¾ç¤ºç»“æœ
            function showResults() {
                const results = userBehaviour.showResult();
                logActivity('ğŸ“‹ å½“å‰è¿½è¸ªç»“æœ', results);

                // åœ¨æ–°çª—å£ä¸­æ˜¾ç¤ºè¯¦ç»†ç»“æœ
                const newWindow = window.open('', '_blank');
                newWindow.document.write(`
                <html>
                    <head><title>ç”¨æˆ·è¡Œä¸ºè¿½è¸ªç»“æœ</title></head>
                    <body style="font-family: monospace; padding: 20px;">
                        <h2>ğŸ“Š ç”¨æˆ·è¡Œä¸ºè¿½è¸ªç»“æœ</h2>
                        <pre>${JSON.stringify(results, null, 2)}</pre>
                    </body>
                </html>
            `);
            }

            // æ¸…é™¤æ—¥å¿—
            function clearLog() {
                document.getElementById('log').innerHTML = '<div>ğŸ“ æ—¥å¿—å·²æ¸…é™¤</div>';
            }

            // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
            function updateStats(results) {
                if (results.clicks) {
                    document.getElementById('clickCount').textContent = results.clicks.clickCount;
                }
                if (results.mouseMovements) {
                    document.getElementById('mouseCount').textContent = results.mouseMovements.length;
                }
                if (results.mouseScroll) {
                    document.getElementById('scrollCount').textContent = results.mouseScroll.length;
                }
                if (results.keyboardActivities) {
                    document.getElementById('keyCount').textContent = results.keyboardActivities.length;
                }
            }

            // è®°å½•æ´»åŠ¨æ—¥å¿—
            function logActivity(message, data = null) {
                const log = document.getElementById('log');
                const timestamp = new Date().toLocaleTimeString();
                const logEntry = document.createElement('div');

                if (data && showDetailedLogs) {
                    // åªæœ‰åœ¨å¼€å¯è¯¦ç»†æ—¥å¿—æ—¶æ‰æ˜¾ç¤ºJSONæ•°æ®
                    logEntry.innerHTML = `[${timestamp}] ${message}<br><pre style="margin: 5px 0; font-size: 11px; color: #a0aec0;">${JSON.stringify(data, null, 2)}</pre>`;
                } else {
                    logEntry.innerHTML = `[${timestamp}] ${message}`;
                }

                log.appendChild(logEntry);
                log.scrollTop = log.scrollHeight;
            }

            // åˆ‡æ¢è¯¦ç»†æ—¥å¿—æ˜¾ç¤º
            function toggleDetailedLogs() {
                showDetailedLogs = !showDetailedLogs;
                const btn = document.getElementById('toggleLogsBtn');
                if (showDetailedLogs) {
                    btn.textContent = 'ğŸ” éšè—è¯¦ç»†æ—¥å¿—';
                    btn.style.background = '#e74c3c';
                } else {
                    btn.textContent = 'ğŸ” æ˜¾ç¤ºè¯¦ç»†æ—¥å¿—';
                    btn.style.background = '#667eea';
                }
                logActivity(`ğŸ” è¯¦ç»†æ—¥å¿—å·²${showDetailedLogs ? 'å¼€å¯' : 'å…³é—­'}`);
            }

            // å¤„ç†ç‚¹å‡»äº‹ä»¶
            function handleClick(buttonName) {
                logActivity(`ğŸ–±ï¸ ç‚¹å‡»äº† ${buttonName}`);
            }

            // å¤„ç†è¡¨å•æäº¤
            function handleFormSubmit(event) {
                event.preventDefault();
                logActivity('ğŸ“ è¡¨å•æäº¤äº‹ä»¶è¢«è§¦å‘');
            }

            // å¤„ç†è§¦æ‘¸äº‹ä»¶
            function handleTouch(event) {
                logActivity('ğŸ“± è§¦æ‘¸äº‹ä»¶è¢«è§¦å‘', {
                    type: event.type,
                    target: event.target.tagName,
                    touches: event.touches ? event.touches.length : 0,
                    changedTouches: event.changedTouches ? event.changedTouches.length : 0
                });
            }

            // æ¨¡æ‹Ÿé¡µé¢å¯¼èˆª
            function simulateNavigation() {
                const newUrl = window.location.href + '#section-' + Date.now();
                history.pushState({}, '', newUrl);
                logActivity('ğŸ”„ æ¨¡æ‹Ÿé¡µé¢å¯¼èˆª: ' + newUrl);
            }

            // æ”¹å˜ Hash
            function changeHash() {
                window.location.hash = '#hash-' + Date.now();
                logActivity('ğŸ”— URL Hash å·²æ”¹å˜');
            }

            // æ¨¡æ‹Ÿå¯è§æ€§å˜åŒ–
            function simulateVisibilityChange() {
                logActivity('ğŸ‘ï¸ è¯·åˆ‡æ¢åˆ°å…¶ä»–æ ‡ç­¾é¡µæ¥æµ‹è¯•å¯è§æ€§å˜åŒ–');
            }

            // è§¦å‘è‡ªå®šä¹‰äº‹ä»¶
            function triggerCustomEvent(eventType) {
                const eventData = {
                    type: eventType,
                    timestamp: Date.now(),
                    userId: 'demo-user-123'
                };

                const customEvent = new CustomEvent(eventType, {
                    detail: eventData
                });

                window.dispatchEvent(customEvent);
            }

            // æµ‹è¯•è§†é¢‘äº‹ä»¶
            function testVideoEvents() {
                const video = document.getElementById('demo-video');
                if (video) {
                    logActivity('ğŸµ å¼€å§‹æµ‹è¯•è§†é¢‘äº‹ä»¶');

                    // æ‰‹åŠ¨è§¦å‘ä¸€äº›è§†é¢‘äº‹ä»¶æ¥æµ‹è¯•
                    video.dispatchEvent(new Event('play'));
                    logActivity('ğŸµ æ‰‹åŠ¨è§¦å‘ play äº‹ä»¶');

                    setTimeout(() => {
                        video.dispatchEvent(new Event('pause'));
                        logActivity('ğŸµ æ‰‹åŠ¨è§¦å‘ pause äº‹ä»¶');
                    }, 1000);

                    setTimeout(() => {
                        video.dispatchEvent(new Event('ended'));
                        logActivity('ğŸµ æ‰‹åŠ¨è§¦å‘ ended äº‹ä»¶');
                    }, 2000);
                }
            }

            // æ˜¾ç¤ºè§†é¢‘ä¿¡æ¯
            function logVideoInfo() {
                const video = document.getElementById('demo-video');
                if (video) {
                    const info = {
                        id: video.id,
                        src: video.currentSrc,
                        duration: video.duration,
                        currentTime: video.currentTime,
                        paused: video.paused,
                        ended: video.ended,
                        readyState: video.readyState
                    };
                    logActivity('ğŸµ è§†é¢‘ä¿¡æ¯', info);
                }
            }

            // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
            document.addEventListener('DOMContentLoaded', function() {
                logActivity('ğŸ‰ é¡µé¢åŠ è½½å®Œæˆï¼Œç”¨æˆ·è¡Œä¸ºè¿½è¸ªæ¼”ç¤ºå·²å‡†å¤‡å°±ç»ª');
                logActivity('ğŸ’¡ ç‚¹å‡»"å¼€å§‹è¿½è¸ª"æŒ‰é’®å¼€å§‹ä½“éªŒå„ç§è¿½è¸ªåŠŸèƒ½');

                // ä¸ºé”®ç›˜äº¤äº’æµ‹è¯•æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                const keyboardInput = document.getElementById('keyboard-test-input');
                const keyboardTextarea = document.getElementById('keyboard-test-textarea');

                if (keyboardInput) {
                    keyboardInput.addEventListener('input', function(e) {
                        logActivity('âŒ¨ï¸ è¾“å…¥æ¡†å†…å®¹å˜åŒ–', {
                            element: 'input',
                            value: e.target.value,
                            length: e.target.value.length
                        });
                    });

                    keyboardInput.addEventListener('keydown', function(e) {
                        logActivity('âŒ¨ï¸ æŒ‰é”®äº‹ä»¶', {
                            element: 'input',
                            key: e.key,
                            keyCode: e.keyCode,
                            ctrlKey: e.ctrlKey,
                            shiftKey: e.shiftKey,
                            altKey: e.altKey
                        });
                    });
                }

                if (keyboardTextarea) {
                    keyboardTextarea.addEventListener('input', function(e) {
                        logActivity('âŒ¨ï¸ æ–‡æœ¬åŒºåŸŸå†…å®¹å˜åŒ–', {
                            element: 'textarea',
                            value: e.target.value,
                            length: e.target.value.length
                        });
                    });

                    keyboardTextarea.addEventListener('keydown', function(e) {
                        logActivity('âŒ¨ï¸ æŒ‰é”®äº‹ä»¶', {
                            element: 'textarea',
                            key: e.key,
                            keyCode: e.keyCode,
                            ctrlKey: e.ctrlKey,
                            shiftKey: e.shiftKey,
                            altKey: e.altKey
                        });
                    });
                }

                // ä¸ºè§¦æ‘¸äº‹ä»¶æµ‹è¯•æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                const touchArea = document.getElementById('touch-test-area');
                const touchButton = document.getElementById('touch-test-button');
                const touchStatus = document.getElementById('touch-status');

                if (touchArea) {
                    // è§¦æ‘¸äº‹ä»¶ï¼ˆç§»åŠ¨è®¾å¤‡ï¼‰
                    const touchEvents = ['touchstart', 'touchmove', 'touchend', 'touchcancel'];
                    touchEvents.forEach(eventType => {
                        touchArea.addEventListener(eventType, function(e) {
                            e.preventDefault(); // é˜²æ­¢é»˜è®¤è¡Œä¸º
                            handleTouch(e);
                            touchStatus.textContent = `è§¦æ‘¸äº‹ä»¶: ${eventType}`;

                            // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
                            setTimeout(() => {
                                touchStatus.textContent = 'ç­‰å¾…è§¦æ‘¸äº‹ä»¶...';
                            }, 2000);
                        });
                    });

                    // é¼ æ ‡äº‹ä»¶ï¼ˆæ¡Œé¢è®¾å¤‡ï¼‰
                    const mouseEvents = ['mousedown', 'mouseup', 'click'];
                    mouseEvents.forEach(eventType => {
                        touchArea.addEventListener(eventType, function(e) {
                            handleTouch(e);
                            touchStatus.textContent = `é¼ æ ‡äº‹ä»¶: ${eventType}`;

                            // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
                            setTimeout(() => {
                                touchStatus.textContent = 'ç­‰å¾…è§¦æ‘¸äº‹ä»¶...';
                            }, 2000);
                        });
                    });
                }

                if (touchButton) {
                    // ä¸ºæŒ‰é’®æ·»åŠ è§¦æ‘¸å’Œé¼ æ ‡äº‹ä»¶
                    const allEvents = ['touchstart', 'touchend', 'mousedown', 'mouseup', 'click'];
                    allEvents.forEach(eventType => {
                        touchButton.addEventListener(eventType, function(e) {
                            e.preventDefault();
                            handleTouch(e);
                            touchStatus.textContent = `æŒ‰é’®äº‹ä»¶: ${eventType}`;

                            // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
                            setTimeout(() => {
                                touchStatus.textContent = 'ç­‰å¾…è§¦æ‘¸äº‹ä»¶...';
                            }, 2000);
                        });
                    });
                }

                // ä¸ºè§†é¢‘æ·»åŠ é¢å¤–çš„äº‹ä»¶ç›‘å¬å™¨ç”¨äºè°ƒè¯•
                const video = document.getElementById('demo-video');
                if (video) {
                    const events = ['play', 'pause', 'ended', 'timeupdate', 'loadedmetadata', 'canplay'];
                    events.forEach(eventType => {
                        video.addEventListener(eventType, function(e) {
                            logActivity(`ğŸµ è§†é¢‘äº‹ä»¶: ${eventType}`, {
                                currentTime: video.currentTime,
                                duration: video.duration,
                                paused: video.paused
                            });
                        });
                    });
                }
            });

            // æ·»åŠ ä¸€äº›é¢å¤–çš„äº‹ä»¶ç›‘å¬å™¨ç”¨äºæ¼”ç¤º
            document.addEventListener('visibilitychange', function() {
                if (document.hidden) {
                    logActivity('ğŸ‘ï¸ é¡µé¢å˜ä¸ºä¸å¯è§');
                } else {
                    logActivity('ğŸ‘ï¸ é¡µé¢å˜ä¸ºå¯è§');
                }
            });

            // ç›‘å¬çª—å£å¤§å°å˜åŒ–
            let resizeTimeout;
            window.addEventListener('resize', function() {
                clearTimeout(resizeTimeout);
                resizeTimeout = setTimeout(function() {
                    logActivity(`ğŸ“ çª—å£å¤§å°å·²è°ƒæ•´ä¸º: ${window.innerWidth}x${window.innerHeight}`);
                }, 100);
            });

            // NextJS é›†æˆæµ‹è¯•å‡½æ•°
            function testNextJSIntegration() {
                const config = {
                    clicks: true,
                    mouseMovement: true,
                    keyboardActivity: true,
                    mouseScroll: true,
                    autoSendEvents: true,
                    sendUrl: 'http://localhost:3000/api/collect',
                    processTime: 5,
                    processData: (results) => {
                        logActivity('ğŸš€ æ•°æ®å·²å‘é€åˆ° NextJS åç«¯', {
                            ç‚¹å‡»æ¬¡æ•°: results.clicks ?.clickCount || 0,
                            é¼ æ ‡ç§»åŠ¨: results.mouseMovements ?.length || 0,
                            é”®ç›˜æ´»åŠ¨: results.keyboardActivities ?.length || 0
                        });
                    }
                };

                userBehaviour.config(config);
                userBehaviour.start();

                // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
                const statusDiv = document.getElementById('nextjs-status');
                const statusText = document.getElementById('nextjs-status-text');
                if (statusDiv && statusText) {
                    statusDiv.style.display = 'block';
                    statusText.textContent = 'å·²å¯åŠ¨ - æ•°æ®å°†å‘é€åˆ° http://localhost:3000/api/collect';
                    statusText.style.color = 'green';
                }

                logActivity('ğŸš€ NextJS é›†æˆå·²å¯åŠ¨', {
                    å‘é€URL: 'http://localhost:3000/api/collect',
                    å‘é€é—´éš”: '5ç§’'
                });
            }

            function stopNextJSIntegration() {
                userBehaviour.stop();

                // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
                const statusDiv = document.getElementById('nextjs-status');
                const statusText = document.getElementById('nextjs-status-text');
                if (statusDiv && statusText) {
                    statusText.textContent = 'å·²åœæ­¢';
                    statusText.style.color = 'red';
                }

                logActivity('â¹ï¸ NextJS é›†æˆå·²åœæ­¢');
            }

            function testCustomEvent() {
                const customEvent = new CustomEvent('userAction', {
                    detail: {
                        action: 'test',
                        timestamp: new Date().toISOString(),
                        data: 'æµ‹è¯•è‡ªå®šä¹‰äº‹ä»¶æ•°æ®'
                    }
                });
                window.dispatchEvent(customEvent);
                logActivity('ğŸ¯ è‡ªå®šä¹‰äº‹ä»¶å·²è§¦å‘', customEvent.detail);
            }

            function registerCustomEvent() {
                userBehaviour.registerCustomEvent('userAction', (event) => {
                    logActivity('ğŸ¯ æ£€æµ‹åˆ°è‡ªå®šä¹‰äº‹ä»¶', event.detail);
                });
                logActivity('ğŸ“ è‡ªå®šä¹‰äº‹ä»¶ç›‘å¬å™¨å·²æ³¨å†Œ');
            }
        </script>
</body>

</html>