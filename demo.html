<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web User Behaviour - TypeScript 版本演示</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        
        .demo-section {
            margin: 30px 0;
            padding: 20px;
            border: 2px dashed #ddd;
            border-radius: 8px;
            background: #f9f9f9;
        }
        
        .demo-section h3 {
            color: #555;
            margin-top: 0;
        }
        
        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
            transition: background 0.3s;
        }
        
        button:hover {
            background: #5a6fd8;
        }
        
        input, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin: 5px 0;
            font-size: 14px;
        }
        
        .stats {
            background: #e8f4f8;
            padding: 15px;
            border-radius: 6px;
            margin: 20px 0;
            font-family: monospace;
        }
        
        .log {
            background: #2d3748;
            color: #68d391;
            padding: 15px;
            border-radius: 6px;
            margin: 20px 0;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .controls {
            text-align: center;
            margin: 20px 0;
        }
        
        .video-container {
            text-align: center;
            margin: 20px 0;
        }
        
        video {
            max-width: 100%;
            border-radius: 8px;
        }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🎯 Web User Behaviour - TypeScript 版本演示</h1>
        
        <div class="controls">
            <button onclick="startTracking()">🚀 开始追踪</button>
            <button onclick="stopTracking()">⏹️ 停止追踪</button>
            <button onclick="showResults()">📊 显示结果</button>
            <button onclick="clearLog()">🗑️ 清除日志</button>
        </div>
        
        <div class="stats" id="stats">
            <strong>📈 实时统计:</strong><br>
            追踪状态: <span id="status">未开始</span><br>
            点击次数: <span id="clickCount">0</span><br>
            鼠标移动: <span id="mouseCount">0</span><br>
            滚动次数: <span id="scrollCount">0</span><br>
            键盘活动: <span id="keyCount">0</span>
        </div>
        
        <div class="log" id="log">
            <div>💡 提示: 点击"开始追踪"按钮开始用户行为追踪...</div>
        </div>
        
        <div class="grid">
            <div class="demo-section">
                <h3>🖱️ 鼠标交互测试</h3>
                <button onclick="handleClick('按钮1')">点击我 - 按钮1</button>
                <button onclick="handleClick('按钮2')">点击我 - 按钮2</button>
                <button onclick="handleClick('按钮3')">点击我 - 按钮3</button>
                <p>移动鼠标到这个区域，或者点击上面的按钮来测试鼠标追踪功能。</p>
            </div>
            
            <div class="demo-section">
                <h3>⌨️ 键盘交互测试</h3>
                <input type="text" placeholder="在这里输入一些文字来测试键盘追踪..." />
                <textarea placeholder="或者在这个文本区域输入多行文字..."></textarea>
            </div>
        </div>
        
        <div class="grid">
            <div class="demo-section">
                <h3>📝 表单交互测试</h3>
                <form onsubmit="handleFormSubmit(event)">
                    <input type="text" name="username" placeholder="用户名" required />
                    <input type="email" name="email" placeholder="邮箱" required />
                    <button type="submit">提交表单</button>
                </form>
            </div>
            
            <div class="demo-section">
                <h3>📱 触摸事件测试</h3>
                <div style="background: #f0f0f0; padding: 20px; border-radius: 8px; text-align: center;">
                    <p>在移动设备上触摸这个区域来测试触摸事件追踪</p>
                    <button ontouchstart="handleTouch()">触摸测试按钮</button>
                </div>
            </div>
        </div>
        
        <div class="demo-section">
            <h3>🎵 媒体交互测试</h3>
            <div class="video-container">
                <video controls width="400">
                    <source src="https://sample-videos.com/zip/10/mp4/SampleVideo_1280x720_1mb.mp4" type="video/mp4">
                    您的浏览器不支持视频播放。
                </video>
                <p>播放上面的视频来测试媒体交互追踪功能。</p>
            </div>
        </div>
        
        <div class="demo-section">
            <h3>🔄 页面导航测试</h3>
            <button onclick="simulateNavigation()">模拟页面导航</button>
            <button onclick="changeHash()">改变 URL Hash</button>
            <p>点击按钮来测试页面导航追踪功能。</p>
        </div>
        
        <div class="demo-section">
            <h3>📏 窗口调整测试</h3>
            <p>尝试调整浏览器窗口大小来测试窗口尺寸变化追踪。</p>
            <p>或者按 F11 进入/退出全屏模式。</p>
        </div>
        
        <div class="demo-section">
            <h3>👁️ 页面可见性测试</h3>
            <p>切换到其他标签页或最小化浏览器窗口来测试页面可见性变化追踪。</p>
            <button onclick="simulateVisibilityChange()">模拟可见性变化</button>
        </div>
        
        <div class="demo-section">
            <h3>🎯 自定义事件测试</h3>
            <button onclick="triggerCustomEvent('productView')">触发产品浏览事件</button>
            <button onclick="triggerCustomEvent('addToCart')">触发添加购物车事件</button>
            <button onclick="triggerCustomEvent('purchase')">触发购买事件</button>
        </div>
        
        <div style="height: 200px; background: linear-gradient(45deg, #f0f0f0, #e0e0e0); margin: 20px 0; border-radius: 8px; display: flex; align-items: center; justify-content: center;">
            <p>滚动页面来测试滚动事件追踪 📜</p>
        </div>
    </div>

    <!-- 加载编译后的 JavaScript 文件 -->
    <script src="dist/userBehaviour.js"></script>
    
    <script>
        // 全局变量
        let isTracking = false;
        let currentResults = null;
        
        // 配置用户行为追踪
        const config = {
            // 启用所有追踪功能
            userInfo: true,
            clicks: true,
            mouseMovement: true,
            mouseMovementInterval: 0.5,
            mouseScroll: true,
            timeCount: true,
            clearAfterProcess: false,
            processTime: 3, // 每3秒处理一次数据
            windowResize: true,
            visibilitychange: true,
            keyboardActivity: true,
            pageNavigation: true,
            formInteractions: true,
            touchEvents: true,
            audioVideoInteraction: true,
            customEventRegistration: true,
            
            // 自定义数据处理函数
            processData: function(results) {
                currentResults = results;
                updateStats(results);
                logActivity('📊 数据处理完成', results);
            }
        };
        
        // 应用配置
        userBehaviour.config(config);
        
        // 注册自定义事件监听器
        userBehaviour.registerCustomEvent('productView', function(event) {
            logActivity('🛍️ 产品浏览事件', event.detail);
        });
        
        userBehaviour.registerCustomEvent('addToCart', function(event) {
            logActivity('🛒 添加购物车事件', event.detail);
        });
        
        userBehaviour.registerCustomEvent('purchase', function(event) {
            logActivity('💳 购买事件', event.detail);
        });
        
        // 开始追踪
        function startTracking() {
            if (!isTracking) {
                userBehaviour.start();
                isTracking = true;
                document.getElementById('status').textContent = '追踪中...';
                logActivity('🚀 开始用户行为追踪');
            } else {
                logActivity('⚠️ 追踪已经在运行中');
            }
        }
        
        // 停止追踪
        function stopTracking() {
            if (isTracking) {
                userBehaviour.stop();
                isTracking = false;
                document.getElementById('status').textContent = '已停止';
                logActivity('⏹️ 停止用户行为追踪');
            } else {
                logActivity('⚠️ 追踪尚未开始');
            }
        }
        
        // 显示结果
        function showResults() {
            const results = userBehaviour.showResult();
            logActivity('📋 当前追踪结果', results);
            
            // 在新窗口中显示详细结果
            const newWindow = window.open('', '_blank');
            newWindow.document.write(`
                <html>
                    <head><title>用户行为追踪结果</title></head>
                    <body style="font-family: monospace; padding: 20px;">
                        <h2>📊 用户行为追踪结果</h2>
                        <pre>${JSON.stringify(results, null, 2)}</pre>
                    </body>
                </html>
            `);
        }
        
        // 清除日志
        function clearLog() {
            document.getElementById('log').innerHTML = '<div>📝 日志已清除</div>';
        }
        
        // 更新统计信息
        function updateStats(results) {
            if (results.clicks) {
                document.getElementById('clickCount').textContent = results.clicks.clickCount;
            }
            if (results.mouseMovements) {
                document.getElementById('mouseCount').textContent = results.mouseMovements.length;
            }
            if (results.mouseScroll) {
                document.getElementById('scrollCount').textContent = results.mouseScroll.length;
            }
            if (results.keyboardActivities) {
                document.getElementById('keyCount').textContent = results.keyboardActivities.length;
            }
        }
        
        // 记录活动日志
        function logActivity(message, data = null) {
            const log = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            
            if (data) {
                logEntry.innerHTML = `[${timestamp}] ${message}<br><pre style="margin: 5px 0; font-size: 11px; color: #a0aec0;">${JSON.stringify(data, null, 2)}</pre>`;
            } else {
                logEntry.innerHTML = `[${timestamp}] ${message}`;
            }
            
            log.appendChild(logEntry);
            log.scrollTop = log.scrollHeight;
        }
        
        // 处理点击事件
        function handleClick(buttonName) {
            logActivity(`🖱️ 点击了 ${buttonName}`);
        }
        
        // 处理表单提交
        function handleFormSubmit(event) {
            event.preventDefault();
            logActivity('📝 表单提交事件被触发');
        }
        
        // 处理触摸事件
        function handleTouch() {
            logActivity('📱 触摸事件被触发');
        }
        
        // 模拟页面导航
        function simulateNavigation() {
            const newUrl = window.location.href + '#section-' + Date.now();
            history.pushState({}, '', newUrl);
            logActivity('🔄 模拟页面导航: ' + newUrl);
        }
        
        // 改变 Hash
        function changeHash() {
            window.location.hash = '#hash-' + Date.now();
            logActivity('🔗 URL Hash 已改变');
        }
        
        // 模拟可见性变化
        function simulateVisibilityChange() {
            logActivity('👁️ 请切换到其他标签页来测试可见性变化');
        }
        
        // 触发自定义事件
        function triggerCustomEvent(eventType) {
            const eventData = {
                type: eventType,
                timestamp: Date.now(),
                userId: 'demo-user-123'
            };
            
            const customEvent = new CustomEvent(eventType, {
                detail: eventData
            });
            
            window.dispatchEvent(customEvent);
        }
        
        // 页面加载完成后的初始化
        document.addEventListener('DOMContentLoaded', function() {
            logActivity('🎉 页面加载完成，用户行为追踪演示已准备就绪');
            logActivity('💡 点击"开始追踪"按钮开始体验各种追踪功能');
        });
        
        // 添加一些额外的事件监听器用于演示
        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                logActivity('👁️ 页面变为不可见');
            } else {
                logActivity('👁️ 页面变为可见');
            }
        });
        
        // 监听窗口大小变化
        let resizeTimeout;
        window.addEventListener('resize', function() {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(function() {
                logActivity(`📏 窗口大小已调整为: ${window.innerWidth}x${window.innerHeight}`);
            }, 100);
        });
    </script>
</body>
</html>
